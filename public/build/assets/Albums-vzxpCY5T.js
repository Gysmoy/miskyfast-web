var R=Object.defineProperty;var T=(n,i,s)=>i in n?R(n,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[i]=s;var d=(n,i,s)=>T(n,typeof i!="symbol"?i+"":i,s);import{j as e}from"./highlightText-Cf8x2fCZ.js";import{r as m}from"./index-BH53Isel.js";import{c as F}from"./ReactAppend-QR5TrZfj.js";import{B}from"./Base-uEbX2-hx.js";import{C as I}from"./CreateReactScript-BkuQg66_.js";import{T as z}from"./Table-BS72y2hu.js";import{D as x}from"./DxButton-DV0H-ZcL.js";import{R as g}from"./ReactAppend-Vm5G2nof.js";import{S as u}from"./sweetalert2.esm.all-CH_YVA8w.js";import{m as p}from"./main-CZ_LA3zH.js";import{M}from"./Modal-Bsv-S6Ik.js";import{i as H}from"./MenuItemContainer-D-Aykn96.js";import"./index-yBjzXJbu.js";import"./index-B6ujFmsw.js";/* empty css              */import"./index.esm-QEAFbt3Y.js";import"./___vite-browser-external_commonjs-proxy-0zb4Agf2.js";/* empty css               */import"./index-fRpqIG3j.js";class O{constructor(){d(this,"path","customer/canvas-projects");d(this,"paginate",async i=>{try{const{status:s,result:o}=await p.Fetch(`/api/${this.path}/paginate`,{method:"POST",body:JSON.stringify(i)});if(!s)throw new Error((o==null?void 0:o.message)??"Error al obtener los proyectos");return o}catch(s){throw console.error("Error paginating projects:",s),s}});d(this,"get",async i=>{try{const{status:s,result:o}=await p.Fetch(`/api/${this.path}/${i}`,{method:"GET"});if(!s)throw new Error((o==null?void 0:o.message)??"Error al obtener el proyecto");return o}catch(s){throw console.error("Error getting project:",s),s}});d(this,"save",async i=>{try{console.log("ProjectsRest.save called with:",i),console.log("Using URL:",`/api/${this.path}/save`);const{status:s,result:o}=await p.Fetch(`/api/${this.path}/save`,{method:"POST",body:JSON.stringify(i)});if(console.log("Save response:",{status:s,result:o}),!s)throw new Error((o==null?void 0:o.message)??"Error al actualizar el proyecto");return o}catch(s){throw console.error("Error saving project:",s),s}});d(this,"delete",async i=>{try{const{status:s,result:o}=await p.Fetch(`/api/${this.path}/${i}`,{method:"DELETE"});if(!s)throw new Error((o==null?void 0:o.message)??"Error al eliminar el proyecto");return o}catch(s){throw console.error("Error deleting project:",s),s}});d(this,"createCanvasProject",async i=>{try{const{status:s,result:o}=await p.Fetch(`/api/${this.path}/create`,{method:"POST",body:JSON.stringify(i)});if(!s)throw new Error((o==null?void 0:o.message)??"Ocurrió un error al crear el proyecto");return o.data??null}catch(s){throw console.error("Error creating canvas project:",s),s}})}}const f=new O,_=({statuses:n=[]})=>{const i=m.useRef(),s=m.useRef(),o=m.useRef(),[a,k]=m.useState(null),[l,D]=m.useState(null),[h,j]=m.useState(""),y=async t=>{const{isConfirmed:r}=await u.fire({title:"Eliminar proyecto",text:"¿Estás seguro de eliminar este proyecto?",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"});!r||!await f.delete(t)||$(i.current).dxDataGrid("instance").refresh()},N=t=>{const r=t.current;r&&(window.bootstrap?(window.bootstrap.Modal.getInstance(r)||new window.bootstrap.Modal(r)).show():window.$&&$(r).modal("show"))},b=t=>{const r=t.current;r&&(window.bootstrap?(window.bootstrap.Modal.getInstance(r)||new window.bootstrap.Modal(r)).hide():window.$&&$(r).modal("hide"))},w=async t=>{const r=await f.get(t);k(r.data),N(s)},E=t=>{window.open(`/canvas/editor?project=${t}`,"_blank")},v=async t=>{D(t),j(t.name||""),N(o)},S=async t=>{if(t&&t.preventDefault(),console.log("onSaveProjectName called with project:",l),console.log("onSaveProjectName called with projectName:",h),!l||!h.trim()){u.fire({title:"Error",text:"El nombre del proyecto no puede estar vacío",icon:"error"});return}try{console.log("Saving project with data:",{id:l.id,name:h.trim()});const r=await f.save({id:l.id,name:h.trim()});console.log("Save result:",r),r&&(u.fire({title:"Éxito",text:"Nombre del proyecto actualizado correctamente",icon:"success",timer:2e3}),b(o),$(i.current).dxDataGrid("instance").refresh())}catch(r){console.error("Error saving project:",r),u.fire({title:"Error",text:r.message||"No se pudo actualizar el nombre del proyecto",icon:"error"})}},C=t=>{const c={draft:{color:"#fbbf24",text:"Borrador"},completed:{color:"#10b981",text:"Completado"},exported:{color:"#3b82f6",text:"Exportado"},ordered:{color:"#8b5cf6",text:"Pedido realizado"}}[t]||{color:"#6b7280",text:"Desconocido"};return{backgroundColor:`${c.color}20`,color:c.color,text:c.text}},P=t=>t==="draft",Y=f;return e.jsxs(e.Fragment,{children:[e.jsx(z,{gridRef:i,title:"Mis Proyectos",rest:Y,toolBar:t=>{t.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(i.current).dxDataGrid("instance").refresh()}}),t.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Catálogo",onClick:()=>{window.location.href="/catalogo"}}})},columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"name",caption:"Proyecto",width:"300px",cellTemplate:(t,{data:r})=>{t.css("cursor","pointer"),t.on("click",()=>{w(r.id)}),g(t,e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"me-3",children:e.jsx("img",{src:r.thumbnail||"/assets/img/backgrounds/resources/default-image.png",alt:r.name,className:"rounded",style:{width:"50px",height:"50px",objectFit:"cover"},onError:c=>{c.target.src="/assets/img/backgrounds/resources/default-image.png"}})}),e.jsxs("div",{children:[e.jsx("p",{className:"mb-1 fw-bold",children:r.name||"Proyecto sin título"}),e.jsx("small",{className:"text-muted",children:r.description||"Sin descripción"})]})]}))}},{dataField:"created_at",caption:"Fecha Creación",dataType:"date",sortOrder:"desc",cellTemplate:(t,{data:r})=>{t.text(moment(r.created_at).format("DD/MM/YYYY HH:mm"))}},{dataField:"updated_at",caption:"Última Modificación",dataType:"date",cellTemplate:(t,{data:r})=>{t.text(moment(r.updated_at).format("DD/MM/YYYY HH:mm"))}},{dataField:"status",caption:"Estado",cellTemplate:(t,{data:r})=>{const c=C(r.status);g(t,e.jsx("span",{className:"badge rounded-pill px-3 py-2",style:{backgroundColor:c.backgroundColor,color:c.color,fontSize:"12px"},children:c.text}))}},{caption:"Acciones",cellTemplate:(t,{data:r})=>{const c=P(r.status);t.append(x({className:"btn btn-xs btn-light me-1",title:"Ver proyecto",icon:"fa fa-eye",onClick:()=>w(r.id)})),c?(t.append(x({className:"btn btn-xs btn-success me-1",title:"Ir al editor",icon:"fa fa-palette",onClick:()=>E(r.id)})),t.append(x({className:"btn btn-xs btn-primary me-1",title:"Editar nombre",icon:"fa fa-edit",onClick:()=>v(r)})),t.append(x({className:"btn btn-xs btn-danger",title:"Eliminar proyecto",icon:"fa fa-trash",onClick:()=>y(r.id)}))):g(t,e.jsx(H,{content:"Los proyectos finalizados no se pueden editar o eliminar",children:e.jsx("span",{className:"badge bg-secondary ms-2",children:"Finalizado"})}))},allowFiltering:!1,allowExporting:!1}]}),e.jsx(M,{modalRef:s,title:`Detalles del proyecto: ${(a==null?void 0:a.name)||"Sin título"}`,size:"lg",bodyStyle:{backgroundColor:"#ebeff2"},hideButtonSubmit:!0,children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-8",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header p-3",children:e.jsx("h5",{className:"card-title mb-0",children:"Información del Proyecto"})}),e.jsx("div",{className:"card-body p-3",children:e.jsx("table",{className:"table table-borderless table-sm mb-0",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("th",{style:{width:"140px"},children:"Nombre:"}),e.jsx("td",{children:(a==null?void 0:a.name)||"Sin título"})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Descripción:"}),e.jsx("td",{children:(a==null?void 0:a.description)||"Sin descripción"})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Estado:"}),e.jsx("td",{children:(()=>{const t=C(a==null?void 0:a.status);return e.jsx("span",{className:"badge rounded-pill px-3 py-2",style:{backgroundColor:t.backgroundColor,color:t.color},children:t.text})})()})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Creado:"}),e.jsx("td",{children:a?moment(a.created_at).format("DD/MM/YYYY HH:mm"):"-"})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Modificado:"}),e.jsx("td",{children:a?moment(a.updated_at).format("DD/MM/YYYY HH:mm"):"-"})]})]})})})]}),(a==null?void 0:a.configuration)&&e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header p-3",children:e.jsx("h5",{className:"card-title mb-0",children:"Configuración"})}),e.jsx("div",{className:"card-body p-3",children:e.jsx("pre",{className:"bg-light p-3 rounded",style:{fontSize:"12px"},children:JSON.stringify(JSON.parse(a.configuration||"{}"),null,2)})})]})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header p-3",children:e.jsx("h5",{className:"card-title mb-0",children:"Vista Previa"})}),e.jsx("div",{className:"card-body p-3 text-center",children:e.jsx("img",{src:(a==null?void 0:a.thumbnail)||"/assets/img/backgrounds/resources/default-image.png",alt:"Vista previa",className:"img-fluid rounded shadow",style:{maxHeight:"200px"},onError:t=>{t.target.src="/assets/img/backgrounds/resources/default-image.png"}})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header p-3",children:e.jsx("h5",{className:"card-title mb-0",children:"Acciones"})}),e.jsxs("div",{className:"card-body p-3 d-grid gap-2",children:[P(a==null?void 0:a.status)?e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:"btn btn-success",onClick:()=>E(a==null?void 0:a.id),children:[e.jsx("i",{className:"fa fa-palette me-2"}),"Ir al Editor"]}),e.jsxs("button",{className:"btn btn-primary",onClick:()=>{b(s),v(a)},children:[e.jsx("i",{className:"fa fa-edit me-2"}),"Editar Nombre"]}),e.jsxs("button",{className:"btn btn-danger",onClick:()=>{b(s),y(a==null?void 0:a.id)},children:[e.jsx("i",{className:"fa fa-trash me-2"}),"Eliminar Proyecto"]})]}):e.jsxs("div",{className:"alert alert-info mb-0",children:[e.jsx("i",{className:"fa fa-info-circle me-2"}),"Este proyecto está finalizado y no se puede editar."]}),e.jsxs("a",{href:"/catalogo",className:"btn btn-success",children:[e.jsx("i",{className:"fa fa-plus me-2"}),"Ir a la web"]})]})]})]})]})}),e.jsxs(M,{modalRef:o,title:"Editar Nombre del Proyecto",size:"md",onSubmit:S,btnSubmitText:"Guardar Cambios",children:[e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{htmlFor:"projectName",className:"form-label",children:["Nombre del Proyecto ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("input",{type:"text",className:"form-control",id:"projectName",value:h,onChange:t=>j(t.target.value),placeholder:"Ingresa el nombre del proyecto",maxLength:"255",onKeyPress:t=>{t.key==="Enter"&&S()}}),e.jsx("div",{className:"form-text",children:"Máximo 255 caracteres. Este nombre se mostrará en tu lista de proyectos."})]}),l&&e.jsx("div",{className:"alert alert-light",children:e.jsxs("small",{className:"text-muted",children:[e.jsx("strong",{children:"Proyecto actual:"})," ",l.name||"Sin título",e.jsx("br",{}),e.jsx("strong",{children:"Creado:"})," ",moment(l.created_at).format("DD/MM/YYYY HH:mm")]})})]})]})};I((n,i)=>{F.createRoot(n).render(e.jsx(B,{...i,title:"Mis Proyectos",children:e.jsx(_,{...i})}))});
